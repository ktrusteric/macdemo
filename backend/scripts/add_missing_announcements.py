#!/usr/bin/env python3
"""
æ·»åŠ ç¼ºå¤±çš„äº¤æ˜“å…¬å‘Šå’Œè°ƒä»·å…¬å‘Šæ–‡ç« 
è§£å†³Dashboardé¡µé¢å’¨è¯¢æ¦‚è§ˆã€äº¤æ˜“å…¬å‘Šã€è°ƒä»·å…¬å‘Šä¸æ˜¾ç¤ºçš„é—®é¢˜
"""

import asyncio
from motor.motor_asyncio import AsyncIOMotorClient
from datetime import datetime, timedelta
import sys
import os

# æ·»åŠ backendç›®å½•åˆ°Pythonè·¯å¾„
sys.path.append(os.path.dirname(os.path.dirname(__file__)))
from app.core.config import settings

async def add_missing_announcements():
    """æ·»åŠ ç¼ºå¤±çš„å…¬å‘Šç±»å‹æ–‡ç« """
    client = None
    try:
        client = AsyncIOMotorClient(settings.MONGODB_URL)
        db = client[settings.DATABASE_NAME]
        
        # åˆ›å»ºäº¤æ˜“å…¬å‘Šæ–‡ç« 
        trade_announcements = [
            {
                'title': 'å…³äºå¼€å±•å®‰å¹³ç®¡é“å¤©ç„¶æ°”ç«ä»·äº¤æ˜“çš„å…¬å‘Š',
                'content': '''
                äº¤æ˜“ä¸­å¿ƒåŠã€”2025ã€•ç¬¬54å·
                
                ä¸ºè¿›ä¸€æ­¥å“åº”å›½å®¶å¤©ç„¶æ°”å¸‚åœºåŒ–æ”¹é©è¦æ±‚ï¼ŒæœåŠ¡è¡Œä¸šå¥åº·æŒç»­ç¨³å®šå‘å±•ï¼Œä¸Šæµ·çŸ³æ²¹å¤©ç„¶æ°”äº¤æ˜“ä¸­å¿ƒæ‹Ÿå®šäº2025å¹´5æœˆ26æ—¥é€šè¿‡ä¸Šæµ·äº¤æ˜“ä¸­å¿ƒäº¤æ˜“å¹³å°å¼€å±•6æœˆä»½å®‰å¹³ç®¡é“å¤©ç„¶æ°”ç«ä»·äº¤æ˜“ã€‚
                
                ä¸€ã€äº¤æ˜“æ—¶é—´
                2025å¹´5æœˆ26æ—¥ 10:00-11:00
                
                äºŒã€äº§å“ä»‹ç»
                1.äº§å“åç§°ï¼šå¤©ç„¶æ°”
                2.å–æ–¹ï¼šäºæŠ¥åå®¡æ ¸é€šè¿‡åè¿›è¡Œé€šçŸ¥
                3.äº¤æ˜“é‡ï¼š2000ä¸‡ç«‹æ–¹ç±³
                4.äº¤æ”¶æœŸï¼šçº¿ä¸Šæˆäº¤åç¬¬5ä¸ªè‡ªç„¶æ—¥8:00èµ·è‡³2025å¹´6æœˆ30æ—¥8:00
                5.äº¤æ”¶åœ°ï¼šå›½å®¶ç®¡ç½‘å®‰å¹³æ¢çº½ç‚¹
                6.äº¤æ”¶æ–¹å¼ï¼šè‡ªä¸»äº¤æ”¶
                
                ä¸‰ã€äº¤æ˜“å‚æ•°
                - ç«æ‹åº•ä»·ï¼š2.45å…ƒ/æ–¹ï¼ˆå«ç¨ä»·æ ¼ï¼‰
                - æœ€å°åŠ ä»·å¹…åº¦ï¼š0.001å…ƒ/æ–¹
                - å€’è®¡æ—¶è§„åˆ™ï¼š5åˆ†é’Ÿå€’è®¡æ—¶
                ''',
                'type': 'news',
                'source': 'ä¸Šæµ·çŸ³æ²¹å¤©ç„¶æ°”äº¤æ˜“ä¸­å¿ƒ',
                'publish_time': (datetime.now() - timedelta(hours=3)).isoformat(),
                'link': 'https://www.shpgx.com/html/jygg/20250520/7825.html',
                'basic_info_tags': ['äº¤æ˜“å…¬å‘Š'],
                'energy_type_tags': ['ç®¡é“å¤©ç„¶æ°”(PNG)', 'å¤©ç„¶æ°”'],
                'region_tags': ['å…¨å›½'],
                'business_field_tags': ['äº¤æ˜“å¸‚åœº'],
                'beneficiary_tags': ['èƒ½æºä¼ä¸š'],
                'policy_measure_tags': ['å¸‚åœºäº¤æ˜“'],
                'importance_tags': ['å›½å®¶çº§'],
                'created_at': datetime.now(),
                'updated_at': datetime.now()
            },
            {
                'title': 'å…³äºå¼€å±•åæ¸¯ç‡ƒæ°”é›†å›¢æœ‰é™å…¬å¸é‡çƒƒç«ä»·äº¤æ˜“çš„å…¬å‘Š',
                'content': '''
                æœ¬ç€å…¬å¹³ã€å…¬æ­£ã€å…¬å¼€ã€å¸‚åœºåŒ–å®šä»·çš„åŸåˆ™ï¼Œåæ¸¯ç‡ƒæ°”é›†å›¢æœ‰é™å…¬å¸åœ¨ä¸Šæµ·çŸ³æ²¹å¤©ç„¶æ°”äº¤æ˜“ä¸­å¿ƒå¹³å°å¼€å±•é‡çƒƒç«ä»·äº¤æ˜“ã€‚
                
                ä¸€ã€äº¤æ˜“æ—¶é—´
                5æœˆ20æ—¥14:30-15:00
                
                äºŒã€äº§å“ä¿¡æ¯
                1.äº§å“åç§°ï¼šæ¶²å‚é‡çƒƒ(C5+)
                2.å–æ–¹ï¼šåæ¸¯ç‡ƒæ°”é›†å›¢æœ‰é™å…¬å¸
                3.äº¤æ˜“é‡ï¼šçº¦100å¨
                4.äº¤æ”¶æœŸï¼š5æœˆ20æ—¥-6æœˆ30æ—¥
                5.äº¤æ”¶åœ°ï¼šåæ¸¯ä»»ä¸˜æ¶²åŒ–å¤©ç„¶æ°”å·¥å‚
                6.äº¤æ”¶æ–¹å¼ï¼šæ§½è½¦è¿è¾“æ–¹å¼è‡ªæ
                
                ä¸‰ã€äº¤æ˜“å‚æ•°
                - æœ€å°åŠ ä»·å¹…åº¦ï¼š5å…ƒ/å¨
                - æœ€å¤§åŠ ä»·å¹…åº¦ï¼š100å…ƒ/å¨
                - å€’è®¡æ—¶è§„åˆ™ï¼š5åˆ†é’Ÿå€’è®¡æ—¶
                ''',
                'type': 'news',
                'source': 'åæ¸¯ç‡ƒæ°”é›†å›¢æœ‰é™å…¬å¸',
                'publish_time': (datetime.now() - timedelta(hours=2)).isoformat(),
                'link': 'https://www.shpgx.com/html/jygg/20250520/7825.html',
                'basic_info_tags': ['äº¤æ˜“å…¬å‘Š'],
                'energy_type_tags': ['æ¶²åŒ–å¤©ç„¶æ°”(LNG)', 'æ¶²åŒ–çŸ³æ²¹æ°”(LPG)'],
                'region_tags': ['æ²³åŒ—', 'å…¨å›½'],
                'business_field_tags': ['äº¤æ˜“å¸‚åœº'],
                'beneficiary_tags': ['èƒ½æºä¼ä¸š'],
                'policy_measure_tags': ['å¸‚åœºäº¤æ˜“'],
                'importance_tags': ['è¡Œä¸šçº§'],
                'created_at': datetime.now(),
                'updated_at': datetime.now()
            },
            {
                'title': 'å…³äºå¼€å±•çº¿ä¸Šç®¡é“æ°”å¤©ç„¶æ°”ç«ä»·äº¤æ˜“çš„å…¬å‘Š',
                'content': '''
                äº¤æ˜“ä¸­å¿ƒåŠã€”2025ã€•ç¬¬43å·
                
                ä¸ºè¿›ä¸€æ­¥å“åº”å›½å®¶å¤©ç„¶æ°”å¸‚åœºåŒ–æ”¹é©è¦æ±‚ï¼ŒæœåŠ¡è¡Œä¸šå¥åº·æŒç»­ç¨³å®šå‘å±•ï¼Œä¸Šæµ·çŸ³æ²¹å¤©ç„¶æ°”äº¤æ˜“ä¸­å¿ƒæ‹Ÿå®šäº2025å¹´5æœˆ7æ—¥é€šè¿‡ä¸Šæµ·äº¤æ˜“ä¸­å¿ƒäº¤æ˜“å¹³å°å¼€å±•5æœˆä»½çº¿ä¸Šç®¡é“å¤©ç„¶æ°”ç«ä»·äº¤æ˜“ã€‚
                
                ä¸€ã€äº¤æ˜“æ—¶é—´
                2025å¹´5æœˆ7æ—¥10:00-11:00
                
                äºŒã€äº§å“ä»‹ç»
                1.äº§å“åç§°ï¼šå¤©ç„¶æ°”
                2.å–æ–¹ï¼šäºæŠ¥åå®¡æ ¸é€šè¿‡åè¿›è¡Œé€šçŸ¥
                3.äº¤æ˜“é‡ï¼š1550ä¸‡ç«‹æ–¹ç±³
                4.äº¤æ”¶æœŸï¼šçº¿ä¸Šæˆäº¤åç¬¬5ä¸ªè‡ªç„¶æ—¥8:00èµ·è‡³2025å¹´5æœˆ31æ—¥8:00
                5.äº¤æ”¶åœ°ï¼šå›½å®¶ç®¡ç½‘å®‰å¹³æ¢çº½ç‚¹
                6.äº¤æ”¶æ–¹å¼ï¼šè‡ªä¸»äº¤æ”¶
                
                ä¸‰ã€äº¤æ˜“å‚æ•°
                - ç«æ‹åº•ä»·ï¼š2.36å…ƒ/æ–¹ï¼ˆå«ç¨ä»·æ ¼ï¼‰
                - æœ€å°åŠ ä»·å¹…åº¦ï¼š0.01å…ƒ/æ–¹
                - å€’è®¡æ—¶è§„åˆ™ï¼š5åˆ†é’Ÿå€’è®¡æ—¶
                ''',
                'type': 'news',
                'source': 'ä¸Šæµ·çŸ³æ²¹å¤©ç„¶æ°”äº¤æ˜“ä¸­å¿ƒ',
                'publish_time': (datetime.now() - timedelta(hours=1)).isoformat(),
                'link': 'https://www.shpgx.com/html/jygg/20250520/7825.html',
                'basic_info_tags': ['äº¤æ˜“å…¬å‘Š'],
                'energy_type_tags': ['ç®¡é“å¤©ç„¶æ°”(PNG)', 'å¤©ç„¶æ°”'],
                'region_tags': ['å…¨å›½'],
                'business_field_tags': ['äº¤æ˜“å¸‚åœº'],
                'beneficiary_tags': ['èƒ½æºä¼ä¸š'],
                'policy_measure_tags': ['å¸‚åœºäº¤æ˜“'],
                'importance_tags': ['å›½å®¶çº§'],
                'created_at': datetime.now(),
                'updated_at': datetime.now()
            }
        ]
        
        # åˆ›å»ºè°ƒä»·å…¬å‘Šæ–‡ç« 
        price_announcements = [
            {
                'title': 'ä¸­å›½çŸ³æ²¹æµ™æ±Ÿåˆ†å…¬å¸æ¶²åŒ–å¤©ç„¶æ°”(LNG)é”€å”®ä»·æ ¼è°ƒæ•´å…¬å‘Š',
                'content': '''
                æ ¹æ®å¸‚åœºä¾›éœ€æƒ…å†µå’Œæˆæœ¬å˜åŒ–ï¼Œç°å¯¹æ¶²åŒ–å¤©ç„¶æ°”é”€å”®ä»·æ ¼è¿›è¡Œè°ƒæ•´ï¼š
                
                ä¸€ã€è°ƒæ•´æ—¶é—´
                è‡ª2025å¹´5æœˆ30æ—¥12:00èµ·æ‰§è¡Œ
                
                äºŒã€ä»·æ ¼è°ƒæ•´
                1. å·¥ä¸šç”¨æˆ·ï¼šä¸Šè°ƒ200å…ƒ/å¨
                2. åŸå¸‚ç‡ƒæ°”ï¼šä¸Šè°ƒ150å…ƒ/å¨
                3. åŒ–å·¥ç”¨æˆ·ï¼šä¸Šè°ƒ180å…ƒ/å¨
                
                ä¸‰ã€å¤‡æ³¨
                æµ™æ±Ÿåˆ†å…¬å¸ä¿ç•™è°ƒæ•´é”€å”®ä»·æ ¼åŠæ”¿ç­–çš„æƒåˆ©ï¼Œåœ¨æœªå‘å¸ƒæ–°çš„è°ƒä»·å…¬å‘Šä¹‹å‰ï¼Œ
                åœ°åŒºå†…ä»·æ ¼åŠé”€å”®æ”¿ç­–ä¿æŒä¸å˜ã€‚
                ''',
                'type': 'news',
                'source': 'ä¸­å›½çŸ³æ²¹æµ™æ±Ÿåˆ†å…¬å¸',
                'publish_time': (datetime.now() - timedelta(minutes=30)).isoformat(),
                'link': 'https://www.shpgx.com/html/hyzq/20250507/7783.html',
                'basic_info_tags': ['è°ƒä»·å…¬å‘Š'],
                'energy_type_tags': ['æ¶²åŒ–å¤©ç„¶æ°”(LNG)'],
                'region_tags': ['æµ™æ±Ÿ', 'åä¸œåœ°åŒº'],
                'business_field_tags': ['ä»·æ ¼è°ƒæ•´', 'å¸‚åœºåŠ¨æ€'],
                'beneficiary_tags': ['å·¥ä¸šç”¨æˆ·', 'åŸå¸‚ç‡ƒæ°”', 'åŒ–å·¥ä¼ä¸š'],
                'policy_measure_tags': ['ä»·æ ¼æ”¿ç­–'],
                'importance_tags': ['çœçº§'],
                'created_at': datetime.now(),
                'updated_at': datetime.now()
            },
            {
                'title': 'åæ¶¦ç‡ƒæ°”ä¸Šæµ·åœ°åŒºå¤©ç„¶æ°”é—¨ç«™ä»·æ ¼è°ƒæ•´é€šçŸ¥',
                'content': '''
                æ ¹æ®å›½å®¶å‘æ”¹å§”å¤©ç„¶æ°”é—¨ç«™ä»·æ ¼æ”¿ç­–ï¼Œç»“åˆå¸‚åœºæƒ…å†µï¼Œç°å¯¹ä¸Šæµ·åœ°åŒº
                å¤©ç„¶æ°”é—¨ç«™ä»·æ ¼è¿›è¡Œè°ƒæ•´ï¼š
                
                ä¸€ã€æ‰§è¡Œæ—¶é—´
                2025å¹´5æœˆ30æ—¥é›¶æ—¶èµ·æ‰§è¡Œ
                
                äºŒã€ä»·æ ¼è°ƒæ•´å†…å®¹
                1. å±…æ°‘ç”¨æ°”ï¼šç»´æŒç°ä»·ä¸å˜
                2. éå±…æ°‘ç”¨æ°”ï¼šä¸Šè°ƒ0.05å…ƒ/ç«‹æ–¹ç±³
                3. å·¥ä¸šç”¨æ°”ï¼šä¸Šè°ƒ0.08å…ƒ/ç«‹æ–¹ç±³
                
                ä¸‰ã€è°ƒæ•´åŸå› 
                å—å›½é™…å¤©ç„¶æ°”ä»·æ ¼ä¸Šæ¶¨å’Œè¿è¾“æˆæœ¬å¢åŠ å½±å“ã€‚
                ''',
                'type': 'news',
                'source': 'åæ¶¦ç‡ƒæ°”ä¸Šæµ·å…¬å¸',
                'publish_time': (datetime.now() - timedelta(minutes=15)).isoformat(),
                'link': 'https://www.shpgx.com/html/hyzq/20250510/7795.html',
                'basic_info_tags': ['è°ƒä»·å…¬å‘Š'],
                'energy_type_tags': ['å¤©ç„¶æ°”'],
                'region_tags': ['ä¸Šæµ·', 'åä¸œåœ°åŒº'],
                'business_field_tags': ['ä»·æ ¼è°ƒæ•´', 'é—¨ç«™ä»·æ ¼'],
                'beneficiary_tags': ['å±…æ°‘ç”¨æˆ·', 'å·¥ä¸šç”¨æˆ·'],
                'policy_measure_tags': ['ä»·æ ¼æ”¿ç­–'],
                'importance_tags': ['å¸‚çº§'],
                'created_at': datetime.now(),
                'updated_at': datetime.now()
            }
        ]
        
        # æ’å…¥äº¤æ˜“å…¬å‘Š
        if trade_announcements:
            await db.content.insert_many(trade_announcements)
            print(f"âœ… æˆåŠŸæ·»åŠ  {len(trade_announcements)} ç¯‡äº¤æ˜“å…¬å‘Š")
        
        # æ’å…¥è°ƒä»·å…¬å‘Š
        if price_announcements:
            await db.content.insert_many(price_announcements)
            print(f"âœ… æˆåŠŸæ·»åŠ  {len(price_announcements)} ç¯‡è°ƒä»·å…¬å‘Š")
        
        # ç»Ÿè®¡éªŒè¯
        trade_count = await db.content.count_documents({'basic_info_tags': 'äº¤æ˜“å…¬å‘Š'})
        price_count = await db.content.count_documents({'basic_info_tags': 'è°ƒä»·å…¬å‘Š'})
        total_count = await db.content.count_documents({})
        
        print(f"\nğŸ“Š æ•°æ®åº“ç»Ÿè®¡:")
        print(f"   äº¤æ˜“å…¬å‘Š: {trade_count} ç¯‡")
        print(f"   è°ƒä»·å…¬å‘Š: {price_count} ç¯‡")
        print(f"   æ€»æ–‡ç« æ•°: {total_count} ç¯‡")
        
    except Exception as e:
        print(f"âŒ æ·»åŠ å…¬å‘Šå¤±è´¥: {e}")
        import traceback
        traceback.print_exc()
    finally:
        if client:
            await client.close()

if __name__ == "__main__":
    asyncio.run(add_missing_announcements()) 