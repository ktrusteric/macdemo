<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜ç™»å½•è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .success {
            background: #c6f6d5;
            color: #2f855a;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .info {
            background: #bee3f8;
            color: #2b6cb0;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #3182ce;
        }
        pre {
            background: #f7fafc;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç®¡ç†å‘˜ç™»å½•è°ƒè¯•å·¥å…·</h1>
        <p>è¯Šæ–­ç®¡ç†å‘˜ç™»å½•é—®é¢˜çš„è¯¦ç»†å·¥å…·</p>
        
        <div class="info">
            <strong>å½“å‰çŠ¶æ€:</strong><br>
            å‰ç«¯åœ°å€: <span id="frontendUrl">æ£€æµ‹ä¸­...</span><br>
            åç«¯åœ°å€: <span id="backendUrl">æ£€æµ‹ä¸­...</span><br>
            æ—¶é—´: <span id="currentTime"></span>
        </div>
    </div>

    <div class="container">
        <div class="test-section">
            <h2>ğŸŒ ç½‘ç»œè¿æ¥æµ‹è¯•</h2>
            <button onclick="testNetworkConnection()">ğŸ” æµ‹è¯•ç½‘ç»œè¿æ¥</button>
            <div id="networkResult"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ” ç®¡ç†å‘˜ç™»å½•æµ‹è¯•</h2>
            <button onclick="testAdminLogin('admin', 'admin123456')">ğŸš€ æµ‹è¯•ä¸»ç®¡ç†å‘˜</button>
            <button onclick="testAdminLogin('superadmin', 'super123456')">ğŸš€ æµ‹è¯•è¶…çº§ç®¡ç†å‘˜</button>
            <div id="loginResult"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š APIåŠŸèƒ½æµ‹è¯•</h2>
            <button onclick="testApiEndpoints()">ğŸ” æµ‹è¯•APIç«¯ç‚¹</button>
            <div id="apiResult"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ å‰ç«¯é¡µé¢æµ‹è¯•</h2>
            <button onclick="testFrontendPages()">ğŸ” æµ‹è¯•å‰ç«¯é¡µé¢</button>
            <div id="frontendResult"></div>
        </div>
    </div>

    <script>
        let adminToken = null;

        // æ›´æ–°å½“å‰æ—¶é—´
        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleString();
        }

        // æ£€æµ‹URL
        function detectUrls() {
            const currentUrl = window.location.href;
            const baseUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/'));
            
            document.getElementById('frontendUrl').textContent = 'http://localhost:5173 æˆ– http://localhost:5174';
            document.getElementById('backendUrl').textContent = 'http://localhost:8001';
        }

        // æµ‹è¯•ç½‘ç»œè¿æ¥
        async function testNetworkConnection() {
            const resultDiv = document.getElementById('networkResult');
            let results = '<div class="info">ğŸ” æ­£åœ¨æµ‹è¯•ç½‘ç»œè¿æ¥...</div>';
            resultDiv.innerHTML = results;

            const tests = [
                { name: 'åç«¯å¥åº·æ£€æŸ¥', url: '/api/v1/health' },
                { name: 'ç®¡ç†å‘˜API', url: '/api/v1/admin/stats' },
                { name: 'å‰ç«¯æœåŠ¡5173', url: 'http://localhost:5173' },
                { name: 'å‰ç«¯æœåŠ¡5174', url: 'http://localhost:5174' }
            ];

            for (const test of tests) {
                try {
                    const response = await fetch(test.url, { 
                        method: 'GET',
                        mode: test.url.startsWith('http://localhost:5') ? 'cors' : 'same-origin'
                    });
                    
                    if (response.ok || response.status === 403) {
                        results += `<div class="success">âœ… ${test.name} - æ­£å¸¸ (${response.status})</div>`;
                    } else {
                        results += `<div class="error">âŒ ${test.name} - å¼‚å¸¸ (${response.status})</div>`;
                    }
                } catch (error) {
                    results += `<div class="error">âŒ ${test.name} - è¿æ¥å¤±è´¥: ${error.message}</div>`;
                }
                resultDiv.innerHTML = results;
            }
        }

        // æµ‹è¯•ç®¡ç†å‘˜ç™»å½•
        async function testAdminLogin(username, password) {
            const resultDiv = document.getElementById('loginResult');
            
            try {
                resultDiv.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨ç™»å½•...</div>';
                
                const response = await fetch('/api/v1/admin/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    adminToken = data.access_token;
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            âœ… ${username} ç™»å½•æˆåŠŸ!<br>
                            ç”¨æˆ·å: ${data.admin.username}<br>
                            è§’è‰²: ${data.admin.role}<br>
                            æƒé™: ${data.permissions.join(', ')}<br>
                            Token: ${data.access_token.substring(0, 50)}...
                        </div>
                    `;
                } else {
                    const error = await response.json();
                    resultDiv.innerHTML = `
                        <div class="error">
                            âŒ ${username} ç™»å½•å¤±è´¥: ${error.detail}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        âŒ ç½‘ç»œé”™è¯¯: ${error.message}
                    </div>
                `;
            }
        }

        // æµ‹è¯•APIç«¯ç‚¹
        async function testApiEndpoints() {
            const resultDiv = document.getElementById('apiResult');
            
            if (!adminToken) {
                resultDiv.innerHTML = '<div class="error">âŒ è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·</div>';
                return;
            }
            
            const endpoints = [
                { name: 'è·å–ç»Ÿè®¡æ•°æ®', url: '/api/v1/admin/stats' },
                { name: 'è·å–æ–‡ç« åˆ—è¡¨', url: '/api/v1/admin/articles?page=1&page_size=5' },
                { name: 'è·å–ç”¨æˆ·åˆ—è¡¨', url: '/api/v1/admin/users?page=1&page_size=5' }
            ];
            
            let results = '<div class="info">ğŸ” æ­£åœ¨æµ‹è¯•APIç«¯ç‚¹...</div>';
            resultDiv.innerHTML = results;
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint.url, {
                        headers: {
                            'Authorization': `Bearer ${adminToken}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        results += `<div class="success">âœ… ${endpoint.name} - æˆåŠŸ</div>`;
                        results += `<pre>${JSON.stringify(data, null, 2).substring(0, 200)}...</pre>`;
                    } else {
                        const error = await response.json();
                        results += `<div class="error">âŒ ${endpoint.name} - å¤±è´¥: ${error.detail}</div>`;
                    }
                } catch (error) {
                    results += `<div class="error">âŒ ${endpoint.name} - ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
                }
                resultDiv.innerHTML = results;
            }
        }

        // æµ‹è¯•å‰ç«¯é¡µé¢
        async function testFrontendPages() {
            const resultDiv = document.getElementById('frontendResult');
            
            const pages = [
                { name: 'ç®¡ç†å‘˜ç™»å½•é¡µé¢', url: 'http://localhost:5173/admin/login' },
                { name: 'ç®¡ç†å‘˜ç™»å½•é¡µé¢(5174)', url: 'http://localhost:5174/admin/login' },
                { name: 'ç®¡ç†å‘˜ä»ªè¡¨æ¿', url: 'http://localhost:5173/admin/dashboard' },
                { name: 'ç®¡ç†å‘˜ä»ªè¡¨æ¿(5174)', url: 'http://localhost:5174/admin/dashboard' }
            ];
            
            let results = '<div class="info">ğŸ” æ­£åœ¨æµ‹è¯•å‰ç«¯é¡µé¢...</div>';
            resultDiv.innerHTML = results;
            
            for (const page of pages) {
                try {
                    const response = await fetch(page.url, { mode: 'no-cors' });
                    results += `<div class="success">âœ… ${page.name} - å¯è®¿é—®</div>`;
                    results += `<div class="info">ğŸ”— <a href="${page.url}" target="_blank">æ‰“å¼€é¡µé¢</a></div>`;
                } catch (error) {
                    results += `<div class="error">âŒ ${page.name} - æ— æ³•è®¿é—®</div>`;
                }
                resultDiv.innerHTML = results;
            }
            
            results += `
                <div class="info">
                    ğŸ’¡ æç¤º: è¯·ç‚¹å‡»ä¸Šæ–¹é“¾æ¥ç›´æ¥è®¿é—®ç®¡ç†å‘˜é¡µé¢è¿›è¡Œæµ‹è¯•
                </div>
            `;
            resultDiv.innerHTML = results;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            updateTime();
            detectUrls();
            setInterval(updateTime, 1000);
            
            console.log('ğŸš€ ç®¡ç†å‘˜ç™»å½•è°ƒè¯•å·¥å…·å·²åŠ è½½');
            console.log('ğŸ“ å†…ç½®ç®¡ç†å‘˜è´¦æˆ·:');
            console.log('  - admin / admin123456');
            console.log('  - superadmin / super123456');
            
            // è‡ªåŠ¨æµ‹è¯•ç½‘ç»œè¿æ¥
            setTimeout(testNetworkConnection, 1000);
        };
    </script>
</body>
</html> 